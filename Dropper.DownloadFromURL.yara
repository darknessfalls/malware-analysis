rule dropper_downloadfromurl {
    
    meta: 
        last_updated = "2024-03-11"
        author = "Jarrett Sams"
        description = "My Yara rules for the Dropper.DownloadFromURL.exe malware sample"

    strings:
        $self_destruct = {63 00 6D 00 64 00 2E 00 65 00 78 00 65 00 20 00 2F 00 43 00 20 00 70 00 69 00 6E 00 67 00 20 00 31 00 2E 00 31 00 2E 00 31 00 2E 00 31 00 20 00 2D 00 6E 00 20 00 31 00 20 00 2D 00 77 00 20 00 33 00 30 00 30 00 30 00 20 00 3E 00 20 00 4E 00 75 00 6C 00 20 00 26 00 20 00 44 00 65 00 6C 00 20 00 2F 00 66 00 20 00 2F 00 71 00 20 00 22 00 25 00 73 00 22}
        
        $second_stage = {43 00 3A 00 5C 00 55 00 73 00 65 00 72 00 73 00 5C 00 50 00 75 00 62 00 6C 00 69 00 63 00 5C 00 44 00 6F 00 63 00 75 00 6D 00 65 00 6E 00 74 00 73 00 5C 00 43 00 52 00 34 00 33 00 33 00 31 00 30 00 31 00 2E 00 64 00 61 00 74 00 2E 00 65 00 78 00 65} 
        
        $domain_string = {68 00 74 00 74 00 70 00 3A 00 2F 00 2F 00 73 00 73 00 6C 00 2D 00 36 00 35 00 38 00 32 00 64 00 61 00 74 00 61 00 6D 00 61 00 6E 00 61 00 67 00 65 00 72 00 2E 00 68 00 65 00 6C 00 70 00 64 00 65 00 73 00 6B 00 62 00 72 00 6F 00 73 00 2E 00 6C 00 6F 00 63 00 61 00 6C 00 2F 00 66 00 61 00 76 00 69 00 63 00 6F 00 6E 00 2E 00 69 00 63 00 6F}
        
        $CC_string = {68 00 74 00 74 00 70 00 3A 00 2F 00 2F 00 68 00 75 00 73 00 6B 00 79 00 68 00 61 00 63 00 6B 00 73 00 2E 00 64 00 65 00 76 00 00 00 00 00 00 00}
        
        $http_user_agent_header = {4D 00 6F 00 7A 00 69 00 6C 00 6C 00 61 00 2F 00 35 00 2E 00 30}
        
        $PE_magic_byte = "MZ"

    condition:
        $PE_magic_byte at 0 and
        ($http_user_agent_header and $self_destruct) or
        ($domain_string and $second_stage and $http_user_agent_header and $CC_string)
}